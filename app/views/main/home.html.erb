<div class="container-fluid">
    <div class="row">
        <div class="col-md-9 col-sm-12">
            <h2>Global</h2>
            <div class="card mb-4">
                <div class="card-header">
                    Somatório de entradas dos últimos meses
                </div>
                <div class="card-body">
                    <div class="row">
                        <canvas id="clients-amount"></canvas>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    Ultimos pagamentos recebidos
                    <%= link_to 'Editar Meios', payment_forms_path, class:"float-right btn btn-outline-secondary btn-sm" %>
                </div>
                <div class="list-group list-group-flush">
                    <% PaymentForm.all.each do |pform| %>
                        <li class="list-group-item">
                            <h5><%= pform.form %></h5>
                            <table class="table table-borderless text-success">
                                <tbody>
                                    <% Payment.where(payment_form_id: pform.id).order(date: :desc).first(10).each do |payment| %>
                                        <tr class="clickable-row", data-href=" <%= url_for(payment.secret) %> ">
                                            <td style="width: 40%"><%= payment.secret.name%></td>
                                            <td style="width: 30%"><%= number_to_currency(payment.value, :unit => "R$")%></td>
                                            <td style="width: 40%"><%= payment.date.strftime("%d/%m/%Y")%></td>
                                        </tr>
                                    <% end %>
                                </tbody>
                            </table>
                        </li>
                    <% end %>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-sm-12 pt-4">
            <div class="row">
                <div class="col-sm-6 col-md-12">
                    <h5 class="pb-0 mb-2"><b> Quantidade de clientes por plano</b></h5>
                    <% Plan.all.each do |plan|%>
                        <%= plan.profile_name %>
                        <div class="progress mb-2">
                            <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: <%= (plan.secrets.count * 100 / Secret.count) %>%">
                                <%=plan.secrets.count != 0 ? plan.secrets.count : nil%>
                            </div>
                        </div>
                    <% end %>
                    <div class="dropdown-divider mt-0 pt-0"></div>
                </div>
                <div class="col-sm-6 col-md-12">
                    <h5 class="pb-0 mb-2"><b> Meios de pagamento mais usados</b></h5>
                    <% PaymentForm.all.each do |paymentform|%>
                        <%= paymentform.form %>
                        <div class="progress mb-2">
                            <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: <%= (paymentform.payments.count * 100 / Payment.count) %>%">
                                <%= (paymentform.payments.count * 100 / Payment.count) %>%
                            </div>
                        </div>
                    <% end %>
                    <div class="dropdown-divider mt-0 pt-0"></div>
                </div>
                <div class="col-sm-6 col-md-12 mb-2">
                    <h5 ><b>Clientes por data de vencimento</b></h5>
                    <canvas id="clients-amount-pie" class="mb-2" height="300%"></canvas>
                    <div class="dropdown-divider mt-0 pt-0"></div>
                </div>
                <div class="col-sm-6 col-md-12">
                    <%= button_to "Sincronização Seletiva", sync_selective_path, method: :get, class:"btn btn-outline-primary"  %>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.js"></script>
<%= render 'main_graphs' %>
